{% extends "learning_app/base.html" %}
{% load crispy_forms_tags %}

{% block content %}
    <div class="content-section">
        <form method="get" id="courseSelectForm">
            {{ form|crispy }}
            <button type="submit" class="btn btn-primary">Select Course</button>
        </form>

    {% if exercise_grades %}
        <h2>Grades for {{ selected_course.title }}</h2>
        {% for exercise, grades_data in exercise_grades %}
            <h3>{{ exercise.title }}</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Student</th>
                        <th>Attempt 1</th>
                        <th>Attempt 2</th>
                        <th>Attempt 3</th>
                        <th>Highest Score</th>
                    </tr>
                </thead>
                <tbody>
                    {% for grade in grades_data %}
                    <tr>
                        <td>{{ grade.student.username }}</td>
                        {% for attempt in grade.attempts %}
                            <td>
                                {% if attempt %}
                                <a href="{% url 'grades-exercise-detail' user_id=grade.student.id exercise_id=exercise.id attempt_id=attempt.id %}">
                                    {{ attempt.score }}
                                </a>
                                {% else %}
                                    N/A  <!-- or any other placeholder you prefer -->
                                {% endif %}
                            </td>
                        {% endfor %}
                        <td>{{ grade.highest_score }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endfor %}
    {% else %}
        <p>Select a course to view grades.</p>
    {% endif %}
</div>
{% endblock content %}
